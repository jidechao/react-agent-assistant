# ReACT 智能助手

一个基于 OpenAI Agents SDK 的智能助手系统，实现了 ReACT 推理模式（Reasoning and Acting），支持多轮工具调用、对话历史管理、流式响应以及 MCP 工具集成。

## 📋 目录

- [功能特性](#功能特性)
- [系统架构](#系统架构)
- [快速开始](#快速开始)
- [配置指南](#配置指南)
- [使用指南](#使用指南)
- [项目结构](#项目结构)
- [开发指南](#开发指南)
- [常见问题](#常见问题)
- [许可证](#许可证)

## ✨ 功能特性

### 核心功能

- **🧠 ReACT 推理模式**
  - **观察 (Observe)**：仔细分析用户问题和当前可用信息
  - **思考 (Think)**：推理需要采取什么行动来解决问题
  - **行动 (Act)**：使用可用工具执行必要操作
  - **记忆 (Memory)**：记住之前的对话和操作结果

- **🔧 多轮工具调用**
  - 支持复杂任务的多步骤工具调用
  - 自动整合多次工具调用的结果
  - 智能决策何时需要继续调用工具

- **💾 对话历史管理**
  - 支持 SQLite 和 Redis 两种存储方式
  - 自动保存和加载对话历史
  - 保持多次会话的上下文连续性
  - Redis 连接失败时自动降级到 SQLite

- **⚡ 流式响应**
  - 实时输出生成内容
  - 打字机效果的交互体验
  - 降低首字节响应时间

- **🔌 自定义模型提供者**
  - 灵活配置 OpenAI 或兼容服务的 API
  - 支持自定义 base URL
  - 支持多种模型选择

- **🛠️ MCP 工具集成**
  - 支持 stdio 协议（标准输入输出）
  - 支持 SSE 协议（Server-Sent Events）
  - 支持 StreamableHTTP 协议
  - 动态加载和管理工具服务器

### 技术亮点

- ✅ 异步 IO 设计，高效处理并发操作
- ✅ 模块化架构，易于扩展和维护
- ✅ 完善的错误处理和资源清理机制
- ✅ 优雅的命令行交互界面
- ✅ 完整的单元测试覆盖
- ✅ 类型注解和文档字符串

## 🏗️ 系统架构

```
┌─────────────────────────────────────────────────────────────┐
│                     用户交互层                                │
│                  (命令行界面 CLI)                             │
└────────────────────────┬────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────┐
│                    Agent 核心层                               │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │ ReACT 推理   │  │ 工具调用     │  │ 流式输出     │      │
│  │ 引擎         │  │ 管理器       │  │ 处理器       │      │
│  └──────────────┘  └──────────────┘  └──────────────┘      │
└────────────────────────┬────────────────────────────────────┘
                         │
         ┌───────────────┼───────────────┐
         ▼               ▼               ▼
┌─────────────┐  ┌─────────────┐  ┌─────────────┐
│ 模型提供者  │  │ 会话管理    │  │ MCP 工具集成│
│ (Custom     │  │ (SQLite/    │  │ (stdio/sse/ │
│  Provider)  │  │  Redis)     │  │  http)      │
└─────────────┘  └─────────────┘  └─────────────┘
         │               │               │
         └───────────────┼───────────────┘
                         ▼
┌─────────────────────────────────────────────────────────────┐
│                    配置管理层                                 │
│  ┌──────────────┐  ┌──────────────┐                         │
│  │ .env 配置    │  │ mcp_config   │                         │
│  │ 加载器       │  │ .json 加载器 │                         │
│  └──────────────┘  └──────────────┘                         │
└─────────────────────────────────────────────────────────────┘
```

## 🚀 快速开始

### 环境要求

- Python 3.8 或更高版本
- pip 或 uv 包管理器

### 安装步骤

1. **进入项目目录**

```bash
cd react-agent-assistant
```

2. **创建虚拟环境（推荐）**

```bash
# 使用 venv
python -m venv .venv

# 激活虚拟环境
# Windows:
.venv\Scripts\activate

# Linux/Mac:
source .venv/bin/activate
```

3. **安装依赖**

```bash
pip install -r requirements.txt
```

4. **配置环境变量**

```bash
# 复制示例配置文件
cp .env.example .env

# 编辑 .env 文件，设置您的 API 密钥和配置
```

5. **运行程序**

```bash
python main.py
```

## ⚙️ 配置指南

### 1. 环境变量配置

创建 `.env` 文件（从 `.env.example` 复制）：

```env
# OpenAI API 配置
OPENAI_API_KEY=your_api_key_here          # 必需：您的 API 密钥
OPENAI_BASE_URL=https://api.openai.com/v1 # 必需：API 基础 URL
OPENAI_MODEL=gpt-4                         # 必需：使用的模型名称

# Redis 配置（可选）
# REDIS_URL=redis://localhost:6379/0      # 可选：Redis 连接 URL
```

**配置说明：**

| 配置项 | 说明 | 示例 |
|--------|------|------|
| `OPENAI_API_KEY` | OpenAI API 密钥或兼容服务的密钥 | `sk-...` |
| `OPENAI_BASE_URL` | API 端点 URL | `https://api.openai.com/v1` |
| `OPENAI_MODEL` | 模型名称 | `gpt-4`, `gpt-4-turbo`, `gpt-3.5-turbo` |
| `REDIS_URL` | （可选）Redis 连接 URL | `redis://localhost:6379/0` |

**使用其他 API 服务：**

如果您使用的是兼容 OpenAI 接口的其他服务，只需修改 `OPENAI_BASE_URL`：

```env
OPENAI_BASE_URL=https://your-api-service.com/v1
```

### 2. MCP 工具配置

创建 `mcp_config.json` 文件（从 `mcp_config.json.example` 复制）：

```json
{
  "servers": [
    {
      "name": "filesystem",
      "protocol": "stdio",
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-filesystem", "/path/to/directory"]
    },
    {
      "name": "weather",
      "protocol": "sse",
      "url": "http://localhost:8000/sse"
    },
    {
      "name": "calculator",
      "protocol": "streamablehttp",
      "url": "http://localhost:8000/mcp"
    }
  ]
}
```

**协议说明：**

| 协议 | 说明 | 必需字段 | 适用场景 |
|------|------|----------|----------|
| `stdio` | 通过标准输入输出通信 | `command`, `args` | 本地命令行工具 |
| `sse` | 通过 Server-Sent Events 通信 | `url` | 支持 SSE 的 HTTP 服务 |
| `streamablehttp` | 通过 HTTP 流式请求通信 | `url` | 标准 HTTP API 服务 |

**注意：** 如果不需要 MCP 工具，可以删除 `mcp_config.json` 文件或将 `servers` 数组设为空 `[]`。

## 📖 使用指南

### 启动助手

```bash
python main.py
```

### 交互界面

启动后，您将看到欢迎界面：

```
============================================================
欢迎使用 ReACT 智能助手！
============================================================

这是一个基于 ReACT 推理模式的智能助手，能够：
  • 观察和理解您的问题
  • 思考解决方案
  • 使用工具执行操作
  • 记住对话历史

输入 'exit' 或 'quit' 退出程序
输入 Ctrl+C 也可以随时退出

============================================================

您: 
```
